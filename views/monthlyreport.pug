extends layout

block content
  //- Google api Charting.
  script(type='text/javascript').
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    var express = require('express');
    var router = express.Router();

    function monthlyChartReport() {
        let monthlyChartSql = fs.readFileSync(path.resolve(__dirname, 'views/monthly_sales_chart.sql'), 'utf8');

        return pool.query(monthlyChartSql)
                    .then((console.log(es => res.rows)))
                    .then(res => res.rows);
    }

    function drawChart() {
      //define the data used in the chart
      //format for the array: 
      //index[0] = [string, string]
      //index [1 to n] = [item_name, value]
      
      //var chartData = dat.map(obj => [obj.item_name, obj.total_revenue]);
      var chartData;
      chartData = monthlyChartReport();
      //var data = getDataTable());

      var data = google.visualization.arrayToDataTable(chartData);
      //-   ['Name', 'Revenue'] + chartData

      //-   );
        var options = {
        title: 'Sales for the Month of November'
        };
      var chart = new google.visualization.PieChart(document.getElementById('piechart'));
      chart.draw(data, options);
    }   
  table.table.container
    thead
      tr
        th Game
        th Total Sold
        th Total Revenue
    tfoot
      tr
        th Game
        th Total Sold
        th Total Revenue
    tbody
      - for (row of dat)
        tr
          td= row.item_name
          td= row.total_sold
          td= row.total_revenue
  p 
    #piechart(style='width: 800px; height: 400px;')  
  